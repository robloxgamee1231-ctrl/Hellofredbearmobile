<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hello Freddy: Mobile Edition</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden; background: #000;">

    <a-scene xr-mode-ui="enabled: false" embedded loading-screen="dotsColor: red; backgroundColor: black">
        
        <a-assets>
            <img id="floorTex" src="https://i.imgur.com/2mP7Y78.jpeg">
            <img id="freddyFace" src="https://i.imgur.com/3YpX7D6.png">
        </a-assets>

        <a-sky color="#020202"></a-sky>
        <a-plane position="0 0 0" rotation="-90 0 0" width="100" height="100" src="#floorTex" repeat="20 20"></a-plane>
        <a-light type="ambient" intensity="0.2" color="#444"></a-light>

        <a-box position="0 2.5 -5" width="12" height="5" depth="0.5" color="#5a3a22"></a-box> <a-box position="-6 2.5 5" width="0.5" height="5" depth="20" color="#5a3a22"></a-box> <a-box position="6 2.5 5" width="0.5" height="5" depth="20" color="#5a3a22"></a-box> <a-box position="0 2.5 15" width="12" height="5" depth="0.5" color="#5a3a22"></a-box> <a-box position="-2 2.5 5" width="0.5" height="5" depth="8" color="#3d2b1f"></a-box> <a-box position="3 2.5 1" width="6" height="5" depth="0.5" color="#3d2b1f"></a-box> <a-box position="0 5 5" width="12.5" height="0.2" depth="20.5" color="#222"></a-box>

        <a-entity id="rig" movement-controls="controls: joystick; speed: 0.22" position="0 0 10">
            <a-entity camera position="0 1.6 0" look-controls="pointerLockEnabled: true; touchEnabled: true">
                <a-entity light="type: spot; intensity: 2; distance: 15; angle: 40; penumbra: 0.5" position="0 0 0"></a-entity>
                <a-entity cursor="fuse: false" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03" material="color: white; shader: flat"></a-entity>
            </a-entity>
        </a-entity>

        <a-sphere id="freddy" src="#freddyFace" position="4 1.5 -2" radius="1.4">
            <a-entity light="type: point; color: #ff0000; intensity: 1.5; distance: 5" position="0 0.5 1"></a-entity>
        </a-sphere>

    </a-scene>

    <script>
        // FREDDY'S SMART AI
        const freddyEl = document.querySelector('#freddy');
        const playerEl = document.querySelector('[camera]');

        setInterval(() => {
            const freddyPos = freddyEl.object3D.position;
            const playerPos = playerEl.getWorldPosition(new THREE.Vector3());

            // Speed: 0.06 is fast enough to be scary but playable
            const speed = 0.06;

            // X-Axis Movement
            if (freddyPos.x < playerPos.x) freddyPos.x += speed;
            else freddyPos.x -= speed;

            // Z-Axis Movement
            if (freddyPos.z < playerPos.z) freddyPos.z += speed;
            else freddyPos.z -= speed;

            // Rotate Freddy to face the player
            freddyEl.object3D.lookAt(playerPos.x, freddyPos.y, playerPos.z);

            // JUMPSCARE & GAME OVER
            let distance = freddyPos.distanceTo(playerPos);
            if (distance < 2.0) {
                // Trigger a red flash and restart
                document.body.style.backgroundColor = "red";
                alert("FREDDY CAUGHT YOU!");
                location.reload(); 
            }
        }, 50);

        // EXTRA CODE: Force Landscape and Anti-VR Button removal
        window.addEventListener('click', function() {
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            }
        });
    </script>
</body>
</html>
