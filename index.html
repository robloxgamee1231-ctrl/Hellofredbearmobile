<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hello Freddy Fix</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        #startBtn { padding: 20px 40px; font-size: 24px; color: white; background: red; border: none; border-radius: 10px; cursor: pointer; }
        .controls { position: fixed; bottom: 20px; right: 20px; z-index: 100; display: flex; gap: 10px; pointer-events: none; }
        .btn { pointer-events: auto; width: 60px; height: 60px; background: rgba(255,255,255,0.2); border: 2px solid white; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1 style="color:white; font-family:sans-serif;">HELLO FREDDY</h1>
        <button id="startBtn" onclick="startGame()">TAP TO PLAY</button>
    </div>

    <div class="controls">
        <div class="btn" onclick="toggleLight()">ðŸ”¦</div>
    </div>

    <a-scene xr-mode-ui="enabled: false" embedded shadow="type: pcf">
        
        <a-assets>
            <img id="freddyFace" src="https://i.imgur.com/3YpX7D6.png">
        </a-assets>

        <a-light type="ambient" color="#FFF" intensity="0.8"></a-light>
        <a-light type="directional" color="#FFF" intensity="1" position="-1 2 1"></a-light>

        <a-plane position="0 0.01 0" rotation="-90 0 0" width="100" height="100" color="#222"></a-plane>

        <a-entity position="0 0 -10">
            <a-box position="0 2.5 -5" width="15" height="5" depth="0.5" color="#4a301d"></a-box>
            <a-box position="-7.5 2.5 0" rotation="0 90 0" width="10" height="5" depth="0.5" color="#4a301d"></a-box>
            <a-box position="7.5 2.5 0" rotation="0 90 0" width="10" height="5" depth="0.5" color="#4a301d"></a-box>
        </a-entity>

        <a-entity id="rig" movement-controls="controls: joystick; speed: 0.2" position="0 0 5">
            <a-entity id="camera" camera position="0 1.6 0" look-controls="touchEnabled: true">
                <a-cylinder position="-0.4 -0.5 -0.7" rotation="90 0 20" radius="0.1" height="1" color="#f1c27d"></a-cylinder>
                <a-cylinder position="0.4 -0.5 -0.7" rotation="90 0 -20" radius="0.1" height="1" color="#f1c27d"></a-cylinder>
                <a-entity id="fLight" light="type: spot; intensity: 0; distance: 20"></a-entity>
            </a-entity>
        </a-entity>

        <a-sphere id="freddy" src="#freddyFace" position="0 1.5 -8" radius="1.3">
            <a-entity light="type: point; color: red; intensity: 2" position="0 0 1"></a-entity>
        </a-sphere>

        <a-sky color="#87CEEB"></a-sky>

    </a-scene>

    <script>
        function startGame() {
            document.getElementById('overlay').style.display = 'none';
            // Resume Audio/Gfx context
            document.querySelector('a-scene').enterVR(); 
            // Immediately exit VR to stay in mobile mode
            setTimeout(() => { document.querySelector('a-scene').exitVR(); }, 10);
        }

        let lightOn = false;
        function toggleLight() {
            lightOn = !lightOn;
            document.querySelector('#fLight').setAttribute('light', 'intensity', lightOn ? 2 : 0);
        }

        setInterval(() => {
            const freddy = document.querySelector('#freddy').object3D.position;
            const camera = document.querySelector('#camera');
            const player = new THREE.Vector3();
            camera.object3D.getWorldPosition(player);

            const speed = 0.05;
            if (freddy.x < player.x) freddy.x += speed; else freddy.x -= speed;
            if (freddy.z < player.z) freddy.z += speed; else freddy.z -= speed;

            if (freddy.distanceTo(player) < 2) {
                alert("CAUGHT!");
                location.reload();
            }
        }, 50);
    </script>
</body>
</html>
