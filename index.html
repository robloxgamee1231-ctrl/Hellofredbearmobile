<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hello Freddy Chromebook Edition</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; }
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #333 0%, #000 100%);
            z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        #status { color: #ffcc00; margin-bottom: 20px; font-size: 1.2em; text-align: center; }
        #start-btn {
            padding: 20px 60px; font-size: 24px; color: black; background: #ffcc00;
            border: none; border-radius: 5px; cursor: pointer; font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .hud { position: fixed; bottom: 20px; right: 20px; z-index: 1000; display: none; gap: 10px; }
        .btn { width: 70px; height: 70px; background: rgba(255,255,255,0.1); border: 2px solid #ffcc00; border-radius: 10px; color: white; display: flex; align-items: center; justify-content: center; font-size: 12px; pointer-events: auto; }
    </style>
</head>
<body>

    <div id="overlay">
        <div id="status">SYSTEMS READY<br>CHROMEBOOK / MOBILE DETECTED</div>
        <button id="start-btn" onclick="bootGame()">ENTER WORLD</button>
    </div>

    <div class="hud" id="hud">
        <div class="btn" onclick="toggleF()">FLASH (F)</div>
    </div>

    <a-scene xr-mode-ui="enabled: false" embedded shadow="type: basic">
        
        <a-assets>
            <img id="face" src="https://i.imgur.com/3YpX7D6.png">
        </a-assets>

        <a-sky color="#87CEEB"></a-sky>
        <a-light type="ambient" intensity="0.9"></a-light>
        <a-light type="directional" intensity="0.6" position="-1 10 2"></a-light>

        <a-plane position="0 0 0" rotation="-90 0 0" width="100" height="100" color="#222"></a-plane>

        <a-entity id="neighbor-structure" position="0 0 -15">
            <a-box position="0 3 -5" width="16" height="6" depth="0.5" color="#4a301d"></a-box>
            <a-box position="-8 3 0" rotation="0 90 0" width="10" height="6" depth="0.5" color="#4a301d"></a-box>
            <a-box position="8 3 0" rotation="0 90 0" width="10" height="6" depth="0.5" color="#4a301d"></a-box>
            <a-box position="0 6 0" width="17" height="0.5" depth="11" color="#111"></a-box>
        </a-entity>

        <a-entity id="rig" movement-controls="controls: keyboard, joystick; speed: 0.25" position="0 0 25">
            <a-entity id="camera" camera position="0 1.6 0" look-controls="touchEnabled: true">
                <a-cylinder position="-0.4 -0.5 -0.6" rotation="90 0 20" radius="0.08" height="0.8" color="#f1c27d"></a-cylinder>
                <a-cylinder position="0.4 -0.5 -0.6" rotation="90 0 -20" radius="0.08" height="0.8" color="#f1c27d"></a-cylinder>
                <a-entity id="lightBeam" light="type: spot; intensity: 0; distance: 25; angle: 45"></a-entity>
            </a-entity>
        </a-entity>

        <a-sphere id="freddy" src="#face" position="0 1.5 -10" radius="1.5" visible="false">
            <a-entity light="type: point; color: red; intensity: 2" position="0 0 1"></a-entity>
        </a-sphere>

    </a-scene>

    <script>
        let active = false;
        let fOn = false;

        function bootGame() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('hud').style.display = 'flex';
            
            // Spawn Freddy only AFTER user clicks
            const freddy = document.querySelector('#freddy');
            freddy.setAttribute('visible', 'true');
            
            active = true;
            document.querySelector('a-scene').play();
        }

        function toggleF() {
            fOn = !fOn;
            document.querySelector('#lightBeam').setAttribute('light', 'intensity', fOn ? 3 : 0);
        }

        // Keyboard Shortcut for Flashlight
        window.addEventListener('keydown', (e) => {
            if(e.key.toLowerCase() === 'f') toggleF();
        });

        // AI Loop
        setInterval(() => {
            if (!active) return;

            const freddy = document.querySelector('#freddy').object3D.position;
            const rig = document.querySelector('#rig').object3D.position;
            const speed = 0.05;

            // Move X
            if (freddy.x < rig.x) freddy.x += speed; else freddy.x -= speed;
            // Move Z
            if (freddy.z < rig.z) freddy.z += speed; else freddy.z -= speed;

            // Collision Check
            let dist = Math.sqrt(Math.pow(freddy.x - rig.x, 2) + Math.pow(freddy.z - rig.z, 2));
            if (dist < 2.5) {
                alert("THE NEIGHBOR CAUGHT YOU!");
                location.reload();
            }
        }, 50);
    </script>
</body>
</html>
